<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Lời nhắn 10A8 – K24</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      height: 100vh;
    }
    .sidebar {
      width: 250px;
      background: #222;
      color: white;
      padding: 15px;
      overflow-y: auto;
    }
    .sidebar h2 {
      font-size: 18px;
      margin-top: 0;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
    }
    .sidebar li {
      margin: 8px 0;
    }
    .sidebar a {
      color: white;
      text-decoration: none;
      cursor: pointer;
    }
    .sidebar a:hover {
      color: #ffcc00;
    }
    .content {
      flex: 1;
      padding: 20px;
      background: #f9f9f9;
      overflow-y: auto;
    }
    .message {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
    }
    .time {
      font-size: 12px;
      color: #666;
    }
    .sender {
      font-weight: bold;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>

  <div class="sidebar">
    <h2>Danh sách bạn bè (10A8 – K24)</h2>
    <ul>
      <li><a onclick="loadMessages('Phạm Nhật An')">Phạm Nhật An</a></li>
      <li><a onclick="loadMessages('Trần Thục Anh')">Trần Thục Anh</a></li>
      <li><a onclick="loadMessages('Nguyễn Hồng Anh')">Nguyễn Hồng Anh</a></li>
      <li><a onclick="loadMessages('Trương Nguyên Bảo')">Trương Nguyên Bảo</a></li>
      <li><a onclick="loadMessages('Phạm Ngọc Quỳnh Chi')">Phạm Ngọc Quỳnh Chi</a></li>
      <li><a onclick="loadMessages('Chu Ngọc Diệp')">Chu Ngọc Diệp</a></li>
      <li><a onclick="loadMessages('Kim Nhật Dũng')">Kim Nhật Dũng</a></li>
      <li><a onclick="loadMessages('Lê Hải Đăng')">Lê Hải Đăng</a></li>
      <li><a onclick="loadMessages('Nguyễn Anh Đức')">Nguyễn Anh Đức</a></li>
      <li><a onclick="loadMessages('Đàm Trọng Hiếu')">Đàm Trọng Hiếu</a></li>
      <li><a onclick="loadMessages('Phạm Minh Hiếu')">Phạm Minh Hiếu</a></li>
      <li><a onclick="loadMessages('Nguyễn Đức Huy')">Nguyễn Đức Huy</a></li>
      <li><a onclick="loadMessages('Đào Đức Hưng')">Đào Đức Hưng</a></li>
      <li><a onclick="loadMessages('Phạm Cát Khánh')">Phạm Cát Khánh</a></li>
      <li><a onclick="loadMessages('Chu Hà Gia Khánh')">Chu Hà Gia Khánh</a></li>
      <li><a onclick="loadMessages('Ngô Xuân Khoa')">Ngô Xuân Khoa</a></li>
      <li><a onclick="loadMessages('Nguyễn Đăng Khoa')">Nguyễn Đăng Khoa</a></li>
      <li><a onclick="loadMessages('Nguyễn Minh Khôi')">Nguyễn Minh Khôi</a></li>
      <li><a onclick="loadMessages('Phạm Gia Khôi')">Phạm Gia Khôi</a></li>
      <li><a onclick="loadMessages('Trần Tùng Lâm')">Trần Tùng Lâm</a></li>
      <li><a onclick="loadMessages('Trần Lâm')">Trần Lâm</a></li>
      <li><a onclick="loadMessages('Đặng Trần Hà Linh')">Đặng Trần Hà Linh</a></li>
      <li><a onclick="loadMessages('Lê Nhật Minh')">Lê Nhật Minh</a></li>
      <li><a onclick="loadMessages('Nguyễn Vũ Hoàng Minh')">Nguyễn Vũ Hoàng Minh</a></li>
      <li><a onclick="loadMessages('Trần Duy Minh')">Trần Duy Minh</a></li>
      <li><a onclick="loadMessages('Bùi Dương Trà My')">Bùi Dương Trà My</a></li>
      <li><a onclick="loadMessages('Phạm Nhật Nam')">Phạm Nhật Nam</a></li>
      <li><a onclick="loadMessages('Nguyễn Hà Nghiệp')">Nguyễn Hà Nghiệp</a></li>
      <li><a onclick="loadMessages('Nguyễn Minh Ngọc')">Nguyễn Minh Ngọc</a></li>
      <li><a onclick="loadMessages('Trần Gia Phát')">Trần Gia Phát</a></li>
      <li><a onclick="loadMessages('Dương Thị Mai Phương')">Dương Thị Mai Phương</a></li>
      <li><a onclick="loadMessages('Nguyễn Anh Quân')">Nguyễn Anh Quân</a></li>
      <li><a onclick="loadMessages('Nguyễn Minh Sơn')">Nguyễn Minh Sơn</a></li>
      <li><a onclick="loadMessages('Phạm Thanh Thảo')">Phạm Thanh Thảo</a></li>
      <li><a onclick="loadMessages('Nguyễn Thanh Thảo')">Nguyễn Thanh Thảo</a></li>
      <li><a onclick="loadMessages('Tô Phương Thảo')">Tô Phương Thảo</a></li>
      <li><a onclick="loadMessages('Nguyễn Thanh Thủy')">Nguyễn Thanh Thủy</a></li>
      <li><a onclick="loadMessages('Lai Hoàng Lan Thy')">Lai Hoàng Lan Thy</a></li>
      <li><a onclick="loadMessages('Nguyễn Thị Thanh Trà')">Nguyễn Thị Thanh Trà</a></li>
      <li><a onclick="loadMessages('Đỗ Quỳnh Trang')">Đỗ Quỳnh Trang</a></li>
      <li><a onclick="loadMessages('Đặng Khánh Vinh')">Đặng Khánh Vinh</a></li>
      <li><a onclick="loadMessages('Nguyễn Quang Vinh')">Nguyễn Quang Vinh</a></li>
      <li><a onclick="loadMessages('Lê Quang Vũ')">Lê Quang Vũ</a></li>
      <li><a onclick="loadMessages('Vũ Như Ý')">Vũ Như Ý</a></li>
    </ul>
  </div>

  <div class="content">
    <h2 id="user-title">Chọn tên để xem lời nhắn</h2>
    <div id="messages"></div>

        <h3>Gửi lời nhắn</h3>
    <form id="messageForm">
      <label for="receiver">Người nhận:</label><br>
      <select id="receiver" required>
        <option value="">--Chọn tên--</option>
        <option>Phạm Nhật An</option>
        <option>Trần Thục Anh</option>
        <option>Nguyễn Hồng Anh</option>
        <option>Trương Nguyên Bảo</option>
        <option>Phạm Ngọc Quỳnh Chi</option>
        <option>Chu Ngọc Diệp</option>
        <option>Kim Nhật Dũng</option>
        <option>Lê Hải Đăng</option>
        <option>Nguyễn Anh Đức</option>
        <option>Đàm Trọng Hiếu</option>
        <option>Phạm Minh Hiếu</option>
        <option>Nguyễn Đức Huy</option>
        <option>Đào Đức Hưng</option>
        <option>Phạm Cát Khánh</option>
        <option>Chu Hà Gia Khánh</option>
        <option>Ngô Xuân Khoa</option>
        <option>Nguyễn Đăng Khoa</option>
        <option>Nguyễn Minh Khôi</option>
        <option>Phạm Gia Khôi</option>
        <option>Trần Tùng Lâm</option>
        <option>Trần Lâm</option>
        <option>Đặng Trần Hà Linh</option>
        <option>Lê Nhật Minh</option>
        <option>Nguyễn Vũ Hoàng Minh</option>
        <option>Trần Duy Minh</option>
        <option>Bùi Dương Trà My</option>
        <option>Phạm Nhật Nam</option>
        <option>Nguyễn Hà Nghiệp</option>
        <option>Nguyễn Minh Ngọc</option>
        <option>Trần Gia Phát</option>
        <option>Dương Thị Mai Phương</option>
        <option>Nguyễn Anh Quân</option>
        <option>Nguyễn Minh Sơn</option>
        <option>Phạm Thanh Thảo</option>
        <option>Nguyễn Thanh Thảo</option>
        <option>Tô Phương Thảo</option>
        <option>Nguyễn Thanh Thủy</option>
        <option>Lai Hoàng Lan Thy</option>
        <option>Nguyễn Thị Thanh Trà</option>
        <option>Đỗ Quỳnh Trang</option>
        <option>Đặng Khánh Vinh</option>
        <option>Nguyễn Quang Vinh</option>
        <option>Lê Quang Vũ</option>
        <option>Vũ Như Ý</option>
      </select><br><br>

      <label for="sender">Tên bạn (người gửi):</label><br>
      <input type="text" id="sender" required><br><br>

      <label for="content">Nội dung:</label><br>
      <textarea id="content" rows="4" cols="40" required></textarea><br><br>

      <button type="submit">Gửi</button>
    </form>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD2ikCTbjpBs3L5gwiLKWOp5kAlBpUxSNI",
      authDomain: "a8-noitaoranhungconhodungmanh.firebaseapp.com",
      projectId: "a8-noitaoranhungconhodungmanh",
      storageBucket: "a8-noitaoranhungconhodungmanh.firebasestorage.app",
      messagingSenderId: "795336127757",
      appId: "1:795336127757:web:5351fe6536b37ac90e6c44",
      measurementId: "G-SNXX0VKYXR"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function loadMessages(receiverName) {
      document.getElementById('user-title').innerText = "Lời nhắn dành cho " + receiverName;
      const messagesDiv = document.getElementById('messages');
      messagesDiv.innerHTML = "Đang tải...";

      try {
        const querySnapshot = await db
          .collection("messages")
          .where("receiver", "==", receiverName)
          .orderBy("timestamp", "desc")
          .get();

        messagesDiv.innerHTML = "";
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          messagesDiv.innerHTML += `
            <div class="message">
              <p><strong>${data.sender}</strong>: ${data.content}</p>
              <div class="time">${data.timestamp}</div>
            </div>
          `;
        });

        if (messagesDiv.innerHTML === "") {
          messagesDiv.innerHTML = "<p>Chưa có lời nhắn nào.</p>";
        }

      } catch (error) {
        console.error("Lỗi khi lấy dữ liệu:", error);
        messagesDiv.innerHTML = "<p>Lỗi khi tải dữ liệu.</p>";
      }
    }

    document.getElementById("messageForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const receiver = document.getElementById("receiver").value;
      const sender = document.getElementById("sender").value;
      const content = document.getElementById("content").value;
      const timestamp = new Date().toLocaleString("vi-VN");

      try {
        await db.collection("messages").add({
          receiver,
          sender,
          content,
          timestamp
        });
        alert("Gửi thành công!");
        document.getElementById("messageForm").reset();
      } catch (error) {
        console.error("Lỗi khi gửi tin nhắn:", error);
        alert("Gửi thất bại!");
      }
    });
  </script>
</body>
</html>
