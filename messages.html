<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Lời nhắn 10A8 – K24</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      height: 100vh;
    }
    .sidebar {
      width: 250px;
      background: #222;
      color: white;
      padding: 15px;
      overflow-y: auto;
    }
    .sidebar h2 {
      font-size: 18px;
      margin-top: 0;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
    }
    .sidebar li {
      margin: 8px 0;
    }
    .sidebar a {
      color: white;
      text-decoration: none;
      cursor: pointer;
    }
    .sidebar a:hover {
      color: #ffcc00;
    }
    .content {
      flex: 1;
      padding: 20px;
      background: #f9f9f9;
      overflow-y: auto;
    }
    .message {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
    }
    .time {
      font-size: 12px;
      color: #666;
    }
    .form {
      margin-bottom: 20px;
      padding: 15px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    .form input, .form textarea, .form select {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 8px;
      font-size: 14px;
    }
    .form textarea {
      height: 120px;
      resize: vertical;
    }
    .form button {
      background: #222;
      color: white;
      border: none;
      padding: 10px 15px;
      cursor: pointer;
    }
    .form button:hover {
      background: #ffcc00;
      color: black;
    }
  </style>
</head>
<body>

  <div class="sidebar">
    <h2>Danh sách bạn bè (10A8 – K24)</h2>
    <ul>
      <li><a onclick="loadMessages('Phạm Nhật An')">Phạm Nhật An</a></li>
      <li><a onclick="loadMessages('Trần Thục Anh')">Trần Thục Anh</a></li>
      <li><a onclick="loadMessages('Nguyễn Hồng Anh')">Nguyễn Hồng Anh</a></li>
      <li><a onclick="loadMessages('Trương Nguyên Bảo')">Trương Nguyên Bảo</a></li>
      <li><a onclick="loadMessages('Phạm Ngọc Quỳnh Chi')">Phạm Ngọc Quỳnh Chi</a></li>
      <li><a onclick="loadMessages('Chu Ngọc Diệp')">Chu Ngọc Diệp</a></li>
      <li><a onclick="loadMessages('Kim Nhật Dũng')">Kim Nhật Dũng</a></li>
      <li><a onclick="loadMessages('Lê Hải Đăng')">Lê Hải Đăng</a></li>
      <li><a onclick="loadMessages('Nguyễn Anh Đức')">Nguyễn Anh Đức</a></li>
      <li><a onclick="loadMessages('Đàm Trọng Hiếu')">Đàm Trọng Hiếu</a></li>
      <li><a onclick="loadMessages('Phạm Minh Hiếu')">Phạm Minh Hiếu</a></li>
      <li><a onclick="loadMessages('Nguyễn Đức Huy')">Nguyễn Đức Huy</a></li>
      <li><a onclick="loadMessages('Đào Đức Hưng')">Đào Đức Hưng</a></li>
      <li><a onclick="loadMessages('Phạm Cát Khánh')">Phạm Cát Khánh</a></li>
      <li><a onclick="loadMessages('Chu Hà Gia Khánh')">Chu Hà Gia Khánh</a></li>
      <li><a onclick="loadMessages('Ngô Xuân Khoa')">Ngô Xuân Khoa</a></li>
      <li><a onclick="loadMessages('Nguyễn Đăng Khoa')">Nguyễn Đăng Khoa</a></li>
      <li><a onclick="loadMessages('Nguyễn Minh Khôi')">Nguyễn Minh Khôi</a></li>
      <li><a onclick="loadMessages('Phạm Gia Khôi')">Phạm Gia Khôi</a></li>
      <li><a onclick="loadMessages('Trần Tùng Lâm')">Trần Tùng Lâm</a></li>
      <li><a onclick="loadMessages('Trần Lâm')">Trần Lâm</a></li>
      <li><a onclick="loadMessages('Đặng Trần Hà Linh')">Đặng Trần Hà Linh</a></li>
      <li><a onclick="loadMessages('Lê Nhật Minh')">Lê Nhật Minh</a></li>
      <li><a onclick="loadMessages('Nguyễn Vũ Hoàng Minh')">Nguyễn Vũ Hoàng Minh</a></li>
      <li><a onclick="loadMessages('Trần Duy Minh')">Trần Duy Minh</a></li>
      <li><a onclick="loadMessages('Bùi Dương Trà My')">Bùi Dương Trà My</a></li>
      <li><a onclick="loadMessages('Phạm Nhật Nam')">Phạm Nhật Nam</a></li>
      <li><a onclick="loadMessages('Nguyễn Hà Nghiệp')">Nguyễn Hà Nghiệp</a></li>
      <li><a onclick="loadMessages('Nguyễn Minh Ngọc')">Nguyễn Minh Ngọc</a></li>
      <li><a onclick="loadMessages('Trần Gia Phát')">Trần Gia Phát</a></li>
      <li><a onclick="loadMessages('Dương Thị Mai Phương')">Dương Thị Mai Phương</a></li>
      <li><a onclick="loadMessages('Nguyễn Anh Quân')">Nguyễn Anh Quân</a></li>
      <li><a onclick="loadMessages('Nguyễn Minh Sơn')">Nguyễn Minh Sơn</a></li>
      <li><a onclick="loadMessages('Phạm Thanh Thảo')">Phạm Thanh Thảo</a></li>
      <li><a onclick="loadMessages('Nguyễn Thanh Thảo')">Nguyễn Thanh Thảo</a></li>
      <li><a onclick="loadMessages('Tô Phương Thảo')">Tô Phương Thảo</a></li>
      <li><a onclick="loadMessages('Nguyễn Thanh Thủy')">Nguyễn Thanh Thủy</a></li>
      <li><a onclick="loadMessages('Lai Hoàng Lan Thy')">Lai Hoàng Lan Thy</a></li>
      <li><a onclick="loadMessages('Nguyễn Thị Thanh Trà')">Nguyễn Thị Thanh Trà</a></li>
      <li><a onclick="loadMessages('Đỗ Quỳnh Trang')">Đỗ Quỳnh Trang</a></li>
      <li><a onclick="loadMessages('Đặng Khánh Vinh')">Đặng Khánh Vinh</a></li>
      <li><a onclick="loadMessages('Nguyễn Quang Vinh')">Nguyễn Quang Vinh</a></li>
      <li><a onclick="loadMessages('Lê Quang Vũ')">Lê Quang Vũ</a></li>
      <li><a onclick="loadMessages('Vũ Như Ý')">Vũ Như Ý</a></li>
    </ul>
  </div>

  <div class="content">
    <div class="form">
      <h2>Gửi lời nhắn</h2>
      <input type="text" id="senderInput" placeholder="Tên của bạn...">

      <select id="receiverInput">
        <option value="">-- Chọn người nhận --</option>
        <option value="Phạm Nhật An">Phạm Nhật An</option>
        <option value="Trần Thục Anh">Trần Thục Anh</option>
        <option value="Nguyễn Hồng Anh">Nguyễn Hồng Anh</option>
        <option value="Trương Nguyên Bảo">Trương Nguyên Bảo</option>
        <option value="Phạm Ngọc Quỳnh Chi">Phạm Ngọc Quỳnh Chi</option>
        <option value="Chu Ngọc Diệp">Chu Ngọc Diệp</option>
        <option value="Kim Nhật Dũng">Kim Nhật Dũng</option>
        <option value="Lê Hải Đăng">Lê Hải Đăng</option>
        <option value="Nguyễn Anh Đức">Nguyễn Anh Đức</option>
        <option value="Đàm Trọng Hiếu">Đàm Trọng Hiếu</option>
        <option value="Phạm Minh Hiếu">Phạm Minh Hiếu</option>
        <option value="Nguyễn Đức Huy">Nguyễn Đức Huy</option>
        <option value="Đào Đức Hưng">Đào Đức Hưng</option>
        <option value="Phạm Cát Khánh">Phạm Cát Khánh</option>
        <option value="Chu Hà Gia Khánh">Chu Hà Gia Khánh</option>
        <option value="Ngô Xuân Khoa">Ngô Xuân Khoa</option>
        <option value="Nguyễn Đăng Khoa">Nguyễn Đăng Khoa</option>
        <option value="Nguyễn Minh Khôi">Nguyễn Minh Khôi</option>
        <option value="Phạm Gia Khôi">Phạm Gia Khôi</option>
        <option value="Trần Tùng Lâm">Trần Tùng Lâm</option>
        <option value="Trần Lâm">Trần Lâm</option>
        <option value="Đặng Trần Hà Linh">Đặng Trần Hà Linh</option>
        <option value="Lê Nhật Minh">Lê Nhật Minh</option>
        <option value="Nguyễn Vũ Hoàng Minh">Nguyễn Vũ Hoàng Minh</option>
        <option value="Trần Duy Minh">Trần Duy Minh</option>
        <option value="Bùi Dương Trà My">Bùi Dương Trà My</option>
        <option value="Phạm Nhật Nam">Phạm Nhật Nam</option>
        <option value="Nguyễn Hà Nghiệp">Nguyễn Hà Nghiệp</option>
        <option value="Nguyễn Minh Ngọc">Nguyễn Minh Ngọc</option>
        <option value="Trần Gia Phát">Trần Gia Phát</option>
        <option value="Dương Thị Mai Phương">Dương Thị Mai Phương</option>
        <option value="Nguyễn Anh Quân">Nguyễn Anh Quân</option>
        <option value="Nguyễn Minh Sơn">Nguyễn Minh Sơn</option>
        <option value="Phạm Thanh Thảo">Phạm Thanh Thảo</option>
        <option value="Nguyễn Thanh Thảo">Nguyễn Thanh Thảo</option>
        <option value="Tô Phương Thảo">Tô Phương Thảo</option>
        <option value="Nguyễn Thanh Thủy">Nguyễn Thanh Thủy</option>
        <option value="Lai Hoàng Lan Thy">Lai Hoàng Lan Thy</option>
        <option value="Nguyễn Thị Thanh Trà">Nguyễn Thị Thanh Trà</option>
        <option value="Đỗ Quỳnh Trang">Đỗ Quỳnh Trang</option>
        <option value="Đặng Khánh Vinh">Đặng Khánh Vinh</option>
        <option value="Nguyễn Quang Vinh">Nguyễn Quang Vinh</option>
        <option value="Lê Quang Vũ">Lê Quang Vũ</option>
        <option value="Vũ Như Ý">Vũ Như Ý</option>
      </select>

      <textarea id="messageInput" placeholder="Nhập lời nhắn..."></textarea>
      <button onclick="sendMessage()">Gửi</button>
    </div>

    <h2 id="user-title">Chọn tên để xem lời nhắn</h2>
    <div id="messages"></div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp, query, where, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD2ikCTbjpBs3L5gwiLKWOp5kAlBpUxSNI",
      authDomain: "a8-noitaoranhungconhodungmanh.firebaseapp.com",
      projectId: "a8-noitaoranhungconhodungmanh",
      storageBucket: "a8-noitaoranhungconhodungmanh.firebasestorage.app",
      messagingSenderId: "795336127757",
      appId: "1:795336127757:web:5351fe6536b37ac90e6c44",
      measurementId: "G-SNXX0VKYXR"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Gửi tin nhắn
    async function sendMessage() {
      const sender = document.getElementById("senderInput").value.trim();
      const receiver = document.getElementById("receiverInput").value.trim();
      const content = document.getElementById("messageInput").value.trim();

      if (!sender || !receiver || !content) {
        alert("Vui lòng nhập đầy đủ thông tin!");
        return;
      }

      try {
        await addDoc(collection(db, "messages"), {
          sender: sender,
          receiver: receiver,
          content: content,
          timestamp: serverTimestamp()
        });
        alert("Gửi thành công!");
        document.getElementById("messageInput").value = "";
      } catch (error) {
        console.error("Lỗi khi gửi:", error);
        alert("Không thể gửi tin nhắn, thử lại sau!");
      }
    }
    window.sendMessage = sendMessage;

    // Load tin nhắn
    async function loadMessages(receiverName) {
      document.getElementById('user-title').innerText = "Lời nhắn dành cho " + receiverName;
      const messagesDiv = document.getElementById('messages');
      messagesDiv.innerHTML = "Đang tải...";

      try {
        const q = query(
          collection(db, "messages"),
          where("receiver", "==", receiverName),
          orderBy("timestamp", "desc")
        );
        const snapshot = await getDocs(q);

        messagesDiv.innerHTML = "";
        snapshot.forEach((doc) => {
          const data = doc.data();
          const date = data.timestamp?.toDate ? data.timestamp.toDate().toLocaleString() : "";
          messagesDiv.innerHTML += `
            <div class="message">
              <strong>${data.sender}</strong> (${date}):<br>${data.content}
            </div>
          `;
        });

        if (messagesDiv.innerHTML === "") {
          messagesDiv.innerHTML = "<p>Chưa có lời nhắn nào.</p>";
        }
      } catch (error) {
        console.error("Lỗi khi tải dữ liệu:", error);
        messagesDiv.innerHTML = "<p>Lỗi khi tải dữ liệu.</p>";
      }
    }
    window.loadMessages = loadMessages;
  </script>
</body>
</html>
