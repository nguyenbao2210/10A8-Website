<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Lời nhắn 10A8 – K24</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      height: 100vh;

      background: linear-gradient(-45deg, #1e3c72, #2a5298, #fbc531, #00a8ff);
      background-size: 400% 400%;
      animation: gradientBG 20s ease infinite;
      position: relative;
      z-index: 0;
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: url('lop10a8.jpg') center/cover no-repeat;
      opacity: 0.12;
      z-index: -1; 
    }

    @keyframes gradientBG {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }

    .sidebar {
      width: 250px;
      background: rgba(34, 34, 34, 0.85);
      color: white;
      padding: 15px;
      overflow-y: auto;
    }
    .sidebar h2 {
      font-size: 18px;
      margin-top: 0;
    }
    .sidebar ul {
      list-style: none;
      padding: 0;
    }
    .sidebar li {
      margin: 8px 0;
    }
    .sidebar a {
      color: white;
      text-decoration: none;
      cursor: pointer;
    }
    .sidebar a:hover {
      color: #ffcc00;
    }

    .content {
      flex: 1;
      padding: 20px;
      background: rgba(249, 249, 249, 0.85);
      overflow-y: auto;
      border-radius: 8px;
      margin: 10px;
      max-width: calc(100% - 330px); 
    }

    .message {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
    }
    .time {
      font-size: 12px;
      color: #666;
    }
    .form-section {
      margin-bottom: 20px;
    }
    .form-section input, .form-section select, .form-section textarea {
      width: 100%;
      padding: 8px;
      margin: 5px 0;
      box-sizing: border-box;
    }
    .form-section button {
      padding: 10px 15px;
      background: #222;
      color: white;
      border: none;
      cursor: pointer;
    }
    .form-section button:hover {
      background: #ffcc00;
      color: #222;
    }

    #particles {
      position: fixed;
      inset: 0;
      z-index: 0;        
      pointer-events: none;
    }

    .content, .sidebar {
      position: relative;
      z-index: 1;        
    }

    .right-panel {
      width: 80px;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding-top: 20px;
    }

    .right-panel a {
      color: white;
      text-decoration: none;
      margin: 20px 0;
      font-size: 24px;
      transition: 0.3s;
    }

    .right-panel a:hover {
      color: #ffcc00;
    }
  </style>
</head>
<body>
  
  <div class="sidebar">
    <h2>Danh sách bạn bè (10A8 – K24)</h2>
    <ul>
      <li><a onclick="loadMessages('Phạm Nhật An')">Phạm Nhật An</a></li>
      <li><a onclick="loadMessages('Trần Thục Anh')">Trần Thục Anh</a></li>
      <li><a onclick="loadMessages('Nguyễn Hồng Anh')">Nguyễn Hồng Anh</a></li>
      <li><a onclick="loadMessages('Trương Nguyên Bảo')">Trương Nguyên Bảo</a></li>
      <li><a onclick="loadMessages('Phạm Ngọc Quỳnh Chi')">Phạm Ngọc Quỳnh Chi</a></li>
      <li><a onclick="loadMessages('Chu Ngọc Diệp')">Chu Ngọc Diệp</a></li>
      <li><a onclick="loadMessages('Kim Nhật Dũng')">Kim Nhật Dũng</a></li>
      <li><a onclick="loadMessages('Lê Hải Đăng')">Lê Hải Đăng</a></li>
      <li><a onclick="loadMessages('Nguyễn Anh Đức')">Nguyễn Anh Đức</a></li>
      <li><a onclick="loadMessages('Đàm Trọng Hiếu')">Đàm Trọng Hiếu</a></li>
      <li><a onclick="loadMessages('Phạm Minh Hiếu')">Phạm Minh Hiếu</a></li>
      <li><a onclick="loadMessages('Nguyễn Đức Huy')">Nguyễn Đức Huy</a></li>
      <li><a onclick="loadMessages('Đào Đức Hưng')">Đào Đức Hưng</a></li>
      <li><a onclick="loadMessages('Phạm Cát Khánh')">Phạm Cát Khánh</a></li>
      <li><a onclick="loadMessages('Chu Hà Gia Khánh')">Chu Hà Gia Khánh</a></li>
      <li><a onclick="loadMessages('Ngô Xuân Khoa')">Ngô Xuân Khoa</a></li>
      <li><a onclick="loadMessages('Nguyễn Đăng Khoa')">Nguyễn Đăng Khoa</a></li>
      <li><a onclick="loadMessages('Nguyễn Minh Khôi')">Nguyễn Minh Khôi</a></li>
      <li><a onclick="loadMessages('Phạm Gia Khôi')">Phạm Gia Khôi</a></li>
      <li><a onclick="loadMessages('Trần Tùng Lâm')">Trần Tùng Lâm</a></li>
      <li><a onclick="loadMessages('Trần Lâm')">Trần Lâm</a></li>
      <li><a onclick="loadMessages('Đặng Trần Hà Linh')">Đặng Trần Hà Linh</a></li>
      <li><a onclick="loadMessages('Lê Nhật Minh')">Lê Nhật Minh</a></li>
      <li><a onclick="loadMessages('Nguyễn Vũ Hoàng Minh')">Nguyễn Vũ Hoàng Minh</a></li>
      <li><a onclick="loadMessages('Trần Duy Minh')">Trần Duy Minh</a></li>
      <li><a onclick="loadMessages('Bùi Dương Trà My')">Bùi Dương Trà My</a></li>
      <li><a onclick="loadMessages('Phạm Nhật Nam')">Phạm Nhật Nam</a></li>
      <li><a onclick="loadMessages('Nguyễn Hà Nghiệp')">Nguyễn Hà Nghiệp</a></li>
      <li><a onclick="loadMessages('Nguyễn Minh Ngọc')">Nguyễn Minh Ngọc</a></li>
      <li><a onclick="loadMessages('Trần Gia Phát')">Trần Gia Phát</a></li>
      <li><a onclick="loadMessages('Dương Thị Mai Phương')">Dương Thị Mai Phương</a></li>
      <li><a onclick="loadMessages('Nguyễn Anh Quân')">Nguyễn Anh Quân</a></li>
      <li><a onclick="loadMessages('Nguyễn Minh Sơn')">Nguyễn Minh Sơn</a></li>
      <li><a onclick="loadMessages('Phạm Thanh Thảo')">Phạm Thanh Thảo</a></li>
      <li><a onclick="loadMessages('Nguyễn Thanh Thảo')">Nguyễn Thanh Thảo</a></li>
      <li><a onclick="loadMessages('Tô Phương Thảo')">Tô Phương Thảo</a></li>
      <li><a onclick="loadMessages('Nguyễn Thanh Thủy')">Nguyễn Thanh Thủy</a></li>
      <li><a onclick="loadMessages('Lai Hoàng Lan Thy')">Lai Hoàng Lan Thy</a></li>
      <li><a onclick="loadMessages('Nguyễn Thị Thanh Trà')">Nguyễn Thị Thanh Trà</a></li>
      <li><a onclick="loadMessages('Đỗ Quỳnh Trang')">Đỗ Quỳnh Trang</a></li>
      <li><a onclick="loadMessages('Đặng Khánh Vinh')">Đặng Khánh Vinh</a></li>
      <li><a onclick="loadMessages('Nguyễn Quang Vinh')">Nguyễn Quang Vinh</a></li>
      <li><a onclick="loadMessages('Lê Quang Vũ')">Lê Quang Vũ</a></li>
      <li><a onclick="loadMessages('Vũ Như Ý')">Vũ Như Ý</a></li>
    </ul>
  </div>

<div class="content">
    <div class="form-section">
      <h2>✍️ Gửi lời nhắn</h2>
      <input type="text" id="senderInput" placeholder="Tên của bạn...">
      <select id="receiverInput">
        <option value="">-- Chọn người nhận --</option>
        <option value="Phạm Nhật An">Phạm Nhật An</option>
        <option value="Trần Thục Anh">Trần Thục Anh</option>
        <option value="Nguyễn Hồng Anh">Nguyễn Hồng Anh</option>
        <option value="Trương Nguyên Bảo">Trương Nguyên Bảo</option>
        <option value="Phạm Ngọc Quỳnh Chi">Phạm Ngọc Quỳnh Chi</option>
        <option value="Chu Ngọc Diệp">Chu Ngọc Diệp</option>
        <option value="Kim Nhật Dũng">Kim Nhật Dũng</option>
        <option value="Lê Hải Đăng">Lê Hải Đăng</option>
        <option value="Nguyễn Anh Đức">Nguyễn Anh Đức</option>
        <option value="Đàm Trọng Hiếu">Đàm Trọng Hiếu</option>
        <option value="Phạm Minh Hiếu">Phạm Minh Hiếu</option>
        <option value="Nguyễn Đức Huy">Nguyễn Đức Huy</option>
        <option value="Đào Đức Hưng">Đào Đức Hưng</option>
        <option value="Phạm Cát Khánh">Phạm Cát Khánh</option>
        <option value="Chu Hà Gia Khánh">Chu Hà Gia Khánh</option>
        <option value="Ngô Xuân Khoa">Ngô Xuân Khoa</option>
        <option value="Nguyễn Đăng Khoa">Nguyễn Đăng Khoa</option>
        <option value="Nguyễn Minh Khôi">Nguyễn Minh Khôi</option>
        <option value="Phạm Gia Khôi">Phạm Gia Khôi</option>
        <option value="Trần Tùng Lâm">Trần Tùng Lâm</option>
        <option value="Trần Lâm">Trần Lâm</option>
        <option value="Đặng Trần Hà Linh">Đặng Trần Hà Linh</option>
        <option value="Lê Nhật Minh">Lê Nhật Minh</option>
        <option value="Nguyễn Vũ Hoàng Minh">Nguyễn Vũ Hoàng Minh</option>
        <option value="Trần Duy Minh">Trần Duy Minh</option>
        <option value="Bùi Dương Trà My">Bùi Dương Trà My</option>
        <option value="Phạm Nhật Nam">Phạm Nhật Nam</option>
        <option value="Nguyễn Hà Nghiệp">Nguyễn Hà Nghiệp</option>
        <option value="Nguyễn Minh Ngọc">Nguyễn Minh Ngọc</option>
        <option value="Trần Gia Phát">Trần Gia Phát</option>
        <option value="Dương Thị Mai Phương">Dương Thị Mai Phương</option>
        <option value="Nguyễn Anh Quân">Nguyễn Anh Quân</option>
        <option value="Nguyễn Minh Sơn">Nguyễn Minh Sơn</option>
        <option value="Phạm Thanh Thảo">Phạm Thanh Thảo</option>
        <option value="Nguyễn Thanh Thảo">Nguyễn Thanh Thảo</option>
        <option value="Tô Phương Thảo">Tô Phương Thảo</option>
        <option value="Nguyễn Thanh Thủy">Nguyễn Thanh Thủy</option>
        <option value="Lai Hoàng Lan Thy">Lai Hoàng Lan Thy</option>
        <option value="Nguyễn Thị Thanh Trà">Nguyễn Thị Thanh Trà</option>
        <option value="Đỗ Quỳnh Trang">Đỗ Quỳnh Trang</option>
        <option value="Đặng Khánh Vinh">Đặng Khánh Vinh</option>
        <option value="Nguyễn Quang Vinh">Nguyễn Quang Vinh</option>
        <option value="Lê Quang Vũ">Lê Quang Vũ</option>
        <option value="Vũ Như Ý">Vũ Như Ý</option>
      </select>
      <textarea id="messageInput" rows="5" placeholder="Nhập lời nhắn..."></textarea>
      <button id="submitBtn">Gửi</button>
    </div>

    <h2 id="user-title">Chọn tên để xem lời nhắn</h2>
    <div id="messages"></div>
  </div>

  <div class="right-panel">
    <a href="index.html" title="Trang chủ">🏠</a>
    <a href="gallery.html" title="Gallery">🖼</a>
    <a href="video.html" title="Video">🎬</a>
    <a href="messages.html" title="Lời nhắn">💬</a>
  </div>


  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD2ikCTbjpBs3L5gwiLKWOp5kAlBpUxSNI",
      authDomain: "a8-noitaoranhungconhodungmanh.firebaseapp.com",
      projectId: "a8-noitaoranhungconhodungmanh",
      storageBucket: "a8-noitaoranhungconhodungmanh.firebasestorage.app",
      messagingSenderId: "795336127757",
      appId: "1:795336127757:web:5351fe6536b37ac90e6c44",
      measurementId: "G-SNXX0VKYXR"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function loadMessages(receiverName) {
      document.getElementById('user-title').innerText = "Lời nhắn dành cho " + receiverName;
      const messagesDiv = document.getElementById('messages');
      messagesDiv.innerHTML = "Đang tải...";

      try {
        const q = query(collection(db, "messages"), orderBy("timestamp", "desc"));
        const snapshot = await getDocs(q);

        messagesDiv.innerHTML = "";
        snapshot.forEach((doc) => {
          const data = doc.data();
          if (data.receiver === receiverName) {
            const date = data.timestamp?.toDate ? data.timestamp.toDate().toLocaleString() : "";
            messagesDiv.innerHTML += `
              <div class="message">
                <strong>${data.sender}</strong> (${date}):<br>${data.content}
              </div>
            `;
          }
        });

        if (messagesDiv.innerHTML === "") {
          messagesDiv.innerHTML = "<p>Chưa có lời nhắn nào.</p>";
        }
      } catch (error) {
        console.error("Lỗi khi tải dữ liệu:", error);
        messagesDiv.innerHTML = "<p>Lỗi khi tải dữ liệu.</p>";
      }
    }
    window.loadMessages = loadMessages;

    const submitBtn = document.getElementById("submitBtn");
    submitBtn.addEventListener("click", async () => {
      const sender = document.getElementById("senderInput").value.trim();
      const receiver = document.getElementById("receiverInput").value.trim();
      const msg = document.getElementById("messageInput").value.trim();

      if (!sender || !receiver || !msg) {
        alert("Vui lòng nhập đầy đủ thông tin.");
        return;
      }

      try {
        await addDoc(collection(db, "messages"), {
          sender: sender,
          receiver: receiver,
          content: msg,
          timestamp: new Date()
        });
        alert("Gửi thành công!");
        document.getElementById("messageInput").value = "";
      } catch (error) {
        console.error("Lỗi khi gửi:", error);
        alert("Có lỗi xảy ra khi gửi.");
      }
    });
  </script>

  <canvas id="particles"></canvas>
  <script>
    const canvas = document.getElementById("particles");
    const ctx = canvas.getContext("2d");

    let particles = [];
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    for (let i = 0; i < 120; i++) {  
      particles.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        radius: Math.random() * 2.2 + 0.8,
        speedY: Math.random() * 0.35 + 0.12,
        opacity: Math.random() * 0.5 + 0.3
      });
    }

    function animateParticles() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      particles.forEach(p => {
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(255,255,255,${p.opacity})`;
        ctx.fill();

        p.y += p.speedY;
        if (p.y > canvas.height) {
          p.y = -p.radius;
          p.x = Math.random() * canvas.width;
        }
      });
      requestAnimationFrame(animateParticles);
    }
    animateParticles();
  </script>
</body>
</html>
